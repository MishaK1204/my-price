@if (loading()) {
  <div class="search-loading">
    იტვირთება...
  </div>
}

@if (!loading() && !error()) {
  <my-price-carousel>
    @for (cat of categories(); track cat.title) {
      <my-price-category-item
        [data]="cat"
        [selected]="selectedKey() === cat.key"
        (select)="onSelectCategory($event)"
      ></my-price-category-item>
    }
  </my-price-carousel>

  <my-price-carousel>
    @for (store of visibleStores(); track store.title) {
      <my-price-store-item
        [data]="store"
        [selected]="isStoreSelected(store.key)"
        (click)="onToggleStore(store.key)"
      ></my-price-store-item>
    }
  </my-price-carousel>

  <div class="filters-container">
    <div class="filter-group">
      <label class="filter-label">მინ. ფასი</label>
      <input
        type="number"
        class="filter-input"
        placeholder="0"
        [ngModel]="minPrice()"
        (ngModelChange)="onMinPriceChange($event)"
        min="0"
        step="0.01"
      />
    </div>
    <div class="filter-group">
      <label class="filter-label">მაქს. ფასი</label>
      <input
        type="number"
        class="filter-input"
        placeholder="∞"
        [ngModel]="maxPrice()"
        (ngModelChange)="onMaxPriceChange($event)"
        min="0"
        step="0.01"
      />
    </div>
    <div class="filter-group">
      <label class="filter-label">სორტირება</label>
      <select
        class="filter-select"
        [ngModel]="sort()"
        (ngModelChange)="onSortChange($event)"
      >
        <option [value]="null">აირჩიეთ</option>
        <option [value]="1">რელევანტურობა</option>
        <option [value]="2">ფასი ზრდადობით</option>
        <option [value]="3">ფასი კლებადობით</option>
        <option [value]="4">საუკეთესო ფასდაკლება</option>
      </select>
    </div>
  </div>

  @if (productsLoading()) {
    <div class="search-loading">
      იტვირთება...
    </div>
  }

  @if (!productsLoading() && products() && products().length > 0) {
    <div class="products-grid">
      @for (p of pagedProducts(); track p.name) {
        <my-price-product-item
          [product]="p"
          [store]="p.store"
        ></my-price-product-item>
      }
    </div>
    <my-price-pagination
      [totalItems]="products().length"
      [pageSize]="pageSize()"
      [currentPage]="currentPage()"
      (pageChange)="onPageChange($event)"
    ></my-price-pagination>
  }
}

@if (error()) {
  <div class="search-error">{{ error() }}</div>
}

@if (showScrollToTop()) {
  <button class="scroll-to-top-button" (click)="scrollToTop()" aria-label="Scroll to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M5 15L12 8L19 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
}
